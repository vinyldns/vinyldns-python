version: "3.0"
services:
  integration:
    container_name: "vinyldns-api-integration"
    hostname: "vinyldns-integration"
    image: "vinyldns/build:base-test-integration-latest"
    environment:
      RUN_SERVICES: "tail-logs all"
    env_file:
      - "${ENV_FILE:-.env}"
    ports:
      - "19001-19003:19001-19003/tcp"
      - "19001:19001/udp"
    command: bash -c "cp -r /app/bind9/etc/named.conf.* /etc/bind/ && cp -r /app/bind9/zones/* /var/bind/ && named-checkconf"  
    volumes:
      - ./bind9:/app/bind9   

  api:
    image: "vinyldns/api:latest"
    container_name: "vinyldns-api"
    ports:
      - "9000:9000"
    depends_on:
      - integration
    env_file:
      - "${ENV_FILE:-.env}"  
    volumes:
      - "./conf:/opt/docker/conf"